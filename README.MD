# CalistheniApp API ğŸ’ª

![Node.js](https://img.shields.io/badge/Node.js-18+-green.svg)
![TypeScript](https://img.shields.io/badge/TypeScript-5.0+-blue.svg)
![MongoDB](https://img.shields.io/badge/MongoDB-7.0+-green.svg)
![Express](https://img.shields.io/badge/Express-5.0+-lightgrey.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

**CalistheniApp** es una API RESTful para encontrar y compartir ubicaciones de barras de calistenia. Los usuarios pueden descubrir equipamiento de ejercicio cercano, calificar ubicaciones, y contribuir a una comunidad activa de entrenamiento.

## ğŸŒŸ CaracterÃ­sticas

- ğŸ—ºï¸ **GeolocalizaciÃ³n GPS**: Busca barras por ubicaciÃ³n con radio personalizable
- ğŸ“ **PublicaciÃ³n de ubicaciones**: Los usuarios pueden agregar nuevas barras con coordenadas precisas
- â­ **Sistema de ratings**: Califica y comenta sobre las ubicaciones
- ğŸ” **BÃºsqueda avanzada**: Filtra por tipo de equipamiento, caracterÃ­sticas y puntuaciÃ³n
- ğŸ” **AutenticaciÃ³n JWT**: Sistema seguro de usuarios con roles
- ğŸ“± **API RESTful**: Endpoints bien documentados y fÃ¡ciles de integrar
- ğŸ“Š **DocumentaciÃ³n Swagger**: Interfaz interactiva para testing
- ğŸ›¡ï¸ **ValidaciÃ³n robusta**: ValidaciÃ³n de datos con Zod

## ğŸ—ï¸ TecnologÃ­as

- **Backend**: Node.js + Express.js + TypeScript
- **Base de datos**: MongoDB + Mongoose
- **AutenticaciÃ³n**: JSON Web Tokens (JWT)
- **ValidaciÃ³n**: Zod
- **DocumentaciÃ³n**: Swagger/OpenAPI
- **GeolocalizaciÃ³n**: CÃ¡lculos con fÃ³rmula Haversine
- **Seguridad**: bcrypt para passwords, middleware de autenticaciÃ³n

## ğŸš€ InstalaciÃ³n

### Prerrequisitos

- Node.js 18+
- MongoDB 7.0+
- pnpm (recomendado) o npm

### 1. Clonar el repositorio

```bash
git clone https://github.com/tu-usuario/calisteniapp.git
cd calisteniapp
```

### 2. Instalar dependencias

```bash
pnpm install
# o
npm install
```

### 3. Configurar variables de entorno

Crea un archivo `.env` basado en `.env.example`:

```bash
cp .env.example .env
```

Completa las variables necesarias:

```env
# Database
MONGODB_URI=mongodb://localhost:27017/calisteniapp

# Server
PORT=3000
NODE_ENV=development

# JWT Configuration
JWT_SECRET=tu_clave_secreta_super_larga_y_compleja_aqui
JWT_EXPIRES_IN=7d
```

### 4. Generar clave JWT segura

```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

### 5. Crear el primer administrador

```bash
pnpm run create-admin
```

### 6. Iniciar el servidor

```bash
# Desarrollo
pnpm run dev

# ProducciÃ³n
pnpm run build
pnpm start
```

La API estarÃ¡ disponible en `http://localhost:3000`

## ğŸ“š DocumentaciÃ³n

### Swagger UI
Accede a la documentaciÃ³n interactiva en: `http://localhost:3000/api-docs`

### Endpoints principales

| MÃ©todo | Endpoint | DescripciÃ³n | Auth |
|--------|----------|-------------|------|
| `POST` | `/api/v1/users/register` | Registrar usuario | âŒ |
| `POST` | `/api/v1/users/login` | Iniciar sesiÃ³n | âŒ |
| `GET` | `/api/v1/users/profile` | Perfil usuario | âœ… |
| `POST` | `/api/v1/bars` | Crear barra | âœ… |
| `GET` | `/api/v1/bars` | Listar barras | âŒ |
| `GET` | `/api/v1/bars/search` | Buscar por GPS | âŒ |
| `GET` | `/api/v1/bars/:id` | Obtener barra | âŒ |
| `PUT` | `/api/v1/bars/:id` | Actualizar barra | âœ… |

### Ejemplos de uso

#### 1. Registrar usuario

```bash
curl -X POST http://localhost:3000/api/v1/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "atleta123",
    "email": "atleta@example.com",
    "password": "MiPassword123!",
    "confirmPassword": "MiPassword123!"
  }'
```

#### 2. Buscar barras cercanas

```bash
curl -X GET "http://localhost:3000/api/v1/bars/search?latitude=-33.4489&longitude=-70.6693&radius=5"
```

#### 3. Crear nueva ubicaciÃ³n de barras

```bash
curl -X POST http://localhost:3000/api/v1/bars \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer tu_jwt_token" \
  -d '{
    "name": "Parque O'\'Higgins - Ãrea Calistenia",
    "description": "Excelente set de barras para entrenar",
    "location": {
      "coordinates": {
        "latitude": -33.4489,
        "longitude": -70.6693
      },
      "address": "Parque O'\'Higgins, Santiago"
    },
    "equipment": {
      "pullUpBar": true,
      "parallelBars": true,
      "rings": false
    },
    "features": {
      "parking": true,
      "lighting": true
    }
  }'
```

## ğŸ›ï¸ Estructura del Proyecto

```
src/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ db.config.ts          # ConfiguraciÃ³n MongoDB
â”‚   â””â”€â”€ swagger.config.ts     # ConfiguraciÃ³n Swagger
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ user.controller.ts    # LÃ³gica de usuarios
â”‚   â””â”€â”€ bar.controller.ts     # LÃ³gica de barras
â”œâ”€â”€ interfaces/
â”‚   â”œâ”€â”€ user.interface.ts     # Tipos de usuario
â”‚   â”œâ”€â”€ bar.interface.ts      # Tipos de barras
â”‚   â”œâ”€â”€ comment.interface.ts  # Tipos de comentarios
â”‚   â””â”€â”€ punctuation.interface.ts # Tipos de ratings
â”œâ”€â”€ middlewares/
â”‚   â””â”€â”€ auth.middleware.ts    # Middleware de autenticaciÃ³n
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ user.schema.ts        # Schema de usuario
â”‚   â”œâ”€â”€ bar.schema.ts         # Schema de barras
â”‚   â”œâ”€â”€ comment.schema.ts     # Schema de comentarios
â”‚   â””â”€â”€ punctuation.schema.ts # Schema de ratings
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ user.routes.ts        # Rutas de usuarios
â”‚   â””â”€â”€ bar.routes.ts         # Rutas de barras
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ createFirstAdmin.ts   # Script crear admin
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ user.helpers.ts       # Utilidades usuario
â”‚   â””â”€â”€ geo.helpers.ts        # Utilidades geolocalizaciÃ³n
â”œâ”€â”€ validations/
â”‚   â”œâ”€â”€ user.validation.ts    # Middleware validaciÃ³n
â”‚   â””â”€â”€ schemas/
â”‚       â”œâ”€â”€ user.schemazod.ts # Schemas Zod usuario
â”‚       â””â”€â”€ bar.schemazod.ts  # Schemas Zod barras
â”œâ”€â”€ server/
â”‚   â””â”€â”€ server.ts             # ConfiguraciÃ³n Express
â””â”€â”€ app.ts                    # Punto de entrada
```

## ğŸ”§ Scripts Disponibles

```bash
# Desarrollo con hot-reload
pnpm run dev

# Crear primer administrador
pnpm run create-admin

# Construir para producciÃ³n
pnpm run build

# Iniciar en producciÃ³n
pnpm start

# Linting (si se configura)
pnpm run lint

# Tests (si se configura)
pnpm test
```

## ğŸŒ Variables de Entorno

| Variable | DescripciÃ³n | Ejemplo |
|----------|-------------|---------|
| `MONGODB_URI` | URI de conexiÃ³n MongoDB | `mongodb://localhost:27017/calisteniapp` |
| `PORT` | Puerto del servidor | `3000` |
| `JWT_SECRET` | Clave secreta para JWT | `tu_clave_super_secreta` |
| `JWT_EXPIRES_IN` | Tiempo de expiraciÃ³n JWT | `7d` |
| `NODE_ENV` | Entorno de ejecuciÃ³n | `development` |

## ğŸ“Š Modelo de Datos

### Usuario
```typescript
{
  username: string;        // Ãšnico, 3-30 caracteres
  email: string;          // Ãšnico, formato email
  password: string;       // Hasheado con bcrypt
  role: "admin" | "user"; // Rol del usuario
  active: boolean;        // Estado activo
  registerDate: Date;     // Fecha registro
}
```

### Barra de Calistenia
```typescript
{
  name: string;           // Nombre ubicaciÃ³n
  description: string;    // DescripciÃ³n detallada
  creator: ObjectId;      // Usuario creador
  location: {
    coordinates: {
      latitude: number;   // GPS latitud
      longitude: number;  // GPS longitud
    };
    address?: string;     // DirecciÃ³n opcional
  };
  equipment: {
    pullUpBar: boolean;   // Barra dominadas
    parallelBars: boolean; // Barras paralelas
    wallBars: boolean;    // Espalderas
    rings: boolean;       // Anillas
    other?: string;       // Otro equipamiento
  };
  features: {
    parking: boolean;     // Estacionamiento
    lighting: boolean;    // IluminaciÃ³n nocturna
    accessibility: boolean; // Accesible
    covered: boolean;     // Techado
  };
  averageRating: number;  // Rating promedio
  totalRatings: number;   // Total de ratings
  active: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

## ğŸ›¡ï¸ Seguridad

- âœ… ContraseÃ±as hasheadas con bcrypt (salt: 14)
- âœ… AutenticaciÃ³n JWT con expiraciÃ³n configurable
- âœ… ValidaciÃ³n de entrada con Zod
- âœ… Middleware de autorizaciÃ³n por roles
- âœ… ValidaciÃ³n de coordenadas GPS
- âœ… Rate limiting (prÃ³ximamente)
- âœ… SanitizaciÃ³n de datos

## ğŸŒ GeolocalizaciÃ³n

La API utiliza:
- **FÃ³rmula Haversine** para cÃ¡lculo de distancias precisas
- **ValidaciÃ³n GPS** de coordenadas vÃ¡lidas (-90/90, -180/180)
- **BÃºsqueda por radio** hasta 50km
- **PrevenciÃ³n de duplicados** en radio de 50 metros
- **Coordenadas de Chile** incluidas para testing

### Ciudades de referencia (Chile)
```javascript
santiago: { latitude: -33.4489, longitude: -70.6693 }
valparaiso: { latitude: -33.0361, longitude: -71.6297 }  
concepcion: { latitude: -36.8201, longitude: -73.0444 }
```

## ğŸš§ Estado del Proyecto

### âœ… Completado
- [x] Sistema de usuarios con autenticaciÃ³n JWT
- [x] CRUD de barras de calistenia
- [x] BÃºsqueda geogrÃ¡fica con GPS
- [x] Filtros avanzados
- [x] DocumentaciÃ³n Swagger
- [x] Validaciones robustas

### ğŸ”„ En Desarrollo
- [ ] Sistema de comentarios
- [ ] Sistema de ratings/puntuaciones
- [ ] Subida de imÃ¡genes
- [ ] Notificaciones
- [ ] Sistema de favoritos

### ğŸ¯ Futuras Mejoras
- [ ] Rate limiting
- [ ] Cache con Redis
- [ ] Tests automatizados
- [ ] Logging avanzado
- [ ] MÃ©tricas y monitoreo
- [ ] WebSocket para actualizaciones en tiempo real

## ğŸ¤ Contribuir

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit tus cambios (`git commit -m 'Add: nueva funcionalidad'`)
4. Push a la rama (`git push origin feature/nueva-funcionalidad`)
5. Abre un Pull Request
<!-- 
## ğŸ“ Licencia

Este proyecto estÃ¡ bajo la Licencia MIT. Ver el archivo [LICENSE](LICENSE) para mÃ¡s detalles.

## ğŸ“ Contacto

- **Autor**: Tu Nombre
- **Email**: tu.email@example.com
- **GitHub**: [@tu-usuario](https://github.com/tu-usuario)

## ğŸ™ Agradecimientos

- Comunidad de calistenia
- Contribuidores de cÃ³digo abierto
- DocumentaciÃ³n de MongoDB, Express y TypeScript

---

**Â¿Encontraste un bug o tienes una sugerencia?** 
[Abre un issue](https://github.com/tu-usuario/calisteniapp/issues) o contribuye al proyecto ğŸš€ -->